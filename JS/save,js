document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('saveBtn').addEventListener('click', function() {
    const data = {
      title: document.getElementById('myTitle').value || null, // タイトル
      mynetwork: typeof getMyNetwork === 'function' ? getMyNetwork() : null, // mynetwork の内容
      hypothesis: document.getElementById('hypothesisOutput')?.innerHTML || null, // hypothesis-area の内容
      extraContent: typeof getExtraContent === 'function' ? getExtraContent() : null, // extra-content-area の内容
    };

    // JSON データを保存
    const jsonBlob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const jsonUrl = URL.createObjectURL(jsonBlob);
    const jsonLink = document.createElement('a');
    jsonLink.href = jsonUrl;
    jsonLink.download = "work.json";
    jsonLink.click();
    URL.revokeObjectURL(jsonUrl);
  });

  document.getElementById('loadBtn').addEventListener('click', function() {
    document.getElementById('loadInput').click();
  });

  document.getElementById('loadInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(evt) {
      const data = JSON.parse(evt.target.result);
      document.getElementById('myTitle').value = data.title || '';
      if (typeof setMyNetwork === 'function' && data.mynetwork) setMyNetwork(data.mynetwork); // mynetwork の復元
      if (document.getElementById('hypothesisOutput')) {
        document.getElementById('hypothesisOutput').innerHTML = data.hypothesis || '';
      }
      if (typeof setExtraContent === 'function' && data.extraContent) {
        setExtraContent(data.extraContent); // extra-content-area の復元
      }
    };
    reader.readAsText(file);
  });
});